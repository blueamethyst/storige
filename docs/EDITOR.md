# Storige 에디터 기획서

---

## 1. 용어 정의

| 용어 | 정의 |
|------|------|
| **상품 (Product)** | 인쇄 상품. 하나 이상의 템플릿셋을 가짐 |
| **템플릿셋 (TemplateSet)** | 템플릿들의 조합. 상품에 연결되어 에디터의 기본 구성을 정의 |
| **템플릿 (Template)** | 단면 1페이지에 해당하는 디자인 틀 |
| **내지 수량** | 템플릿 타입이 "page"인 페이지의 개수 (표지, 날개 등 제외) |
| **판형** | width x height (가로x세로, mm 단위) |

### 템플릿 타입

| 타입 | 설명 | 판형 체크 |
|------|------|----------|
| `wing` | 날개 - 표지를 접었을 때 안쪽으로 접히는 부분 | 제외 |
| `cover` | 표지 - 앞/뒤 표지 (위치로 구분) | 대상 |
| `spine` | 책등 - 책의 등 부분 | 제외 |
| `page` | 내지 - 본문 페이지 | 대상 |

### 템플릿셋 타입별 기본 구성

| 타입 | 구성 |
|------|------|
| **책자 (book)** | 날개(옵션) + 앞표지 + 책등 + 내지 N장 + 뒤표지 + 날개(옵션) |
| **리플렛 (leaflet)** | 앞표지(옵션) + 내지 N장 + 뒤표지(옵션) |

---

## 2. 데이터 구조

### 상품 (Product)

```typescript
interface Product {
  id: string
  name: string
  templateSetIds: string[]  // 1:N 관계
  // ...기타 상품 속성
}
```

### 템플릿셋 (TemplateSet)

```typescript
interface TemplateSet {
  id: string
  name: string
  thumbnail: string
  type: 'book' | 'leaflet'  // 확장 가능
  width: number             // 판형 (mm)
  height: number            // 판형 (mm)
  canAddPage: boolean       // 내지 추가 가능 여부
  pageCountRange: number[]  // 내지 수량 범위 (예: [10, 20, 30, 40])
  templates: TemplateRef[]  // 순서 포함, N:N 관계
  isDeleted: boolean        // 소프트 삭제
}

interface TemplateRef {
  templateId: string
  required: boolean         // 필수 페이지 여부
}
```

### 템플릿 (Template)

```typescript
interface Template {
  id: string
  name: string
  thumbnail: string
  type: 'wing' | 'cover' | 'spine' | 'page'
  width: number             // 판형 (mm)
  height: number            // 판형 (mm)
  editable: boolean         // 편집 가능 여부
  deleteable: boolean       // 삭제 가능 여부
  data: object              // Fabric.js JSON
  isDeleted: boolean        // 소프트 삭제
}
```

### 관계도

```
상품 (1) ──── (N) 템플릿셋 (N) ──── (N) 템플릿
                  └─ templates 배열로 순서 관리
```

### 삭제 정책

- **소프트 삭제**: `isDeleted` 필드 사용
- **템플릿 삭제 시**: 해당 템플릿을 사용 중인 템플릿셋 확인 → 처리 여부 결정
- **템플릿셋 삭제 시**: 해당 템플릿셋을 사용 중인 상품 확인 → 처리 여부 결정

---

## 3. 비즈니스 룰

### 템플릿셋 선택

- **기본**: 쇼핑몰에서 상품 옵션 선택 시 (에디터 진입 전)
- **추가**: 에디터 내 템플릿 패널에서 다른 템플릿셋으로 교체 가능

### 내지(page) 관리

| 항목 | 정책 |
|------|------|
| 추가 시 템플릿 | 마지막 내지 템플릿 복제 |
| 추가 위치 | 마지막 내지 뒤 (뒤표지 앞) |
| 삭제 대상 | 현재 선택된 내지 페이지 |
| 삭제 불가 페이지 | UI 비활성화 + 에러 처리 (이중 방어) |
| 수량 범위 초과/미만 | UI 비활성화 + 에러 처리 (이중 방어) |

### 템플릿 교체

| 항목 | 정책 |
|------|------|
| 전체 교체 (템플릿셋) | 경고 다이얼로그 → 사용자 추가 요소 보존 |
| 낱장 교체 (템플릿) | 경고 다이얼로그 → 사용자 추가 요소 보존 |
| **보존 대상** | 사용자가 추가한 텍스트, 이미지, 도형 |
| **교체되는 요소** | 템플릿에 원래 있던 요소 |

### 저장 검증

- 내지 수량이 `pageCountRange` 범위 내인지 확인
- 필수 페이지(`required: true`)가 모두 존재하는지 확인

---

## 4. 에디터 기능

### 페이지 관리

| 항목 | 정책 |
|------|------|
| 페이지 네비게이션 | 썸네일 클릭 + 이전/다음 버튼 |
| 페이지 순서 변경 | 내지(page)만 드래그 앤 드롭 가능 (날개, 표지, 책등은 고정) |
| 페이지 추가/삭제 UI | SidePanel + 상단 툴바 |

### 히스토리 & 저장

| 항목 | 정책 |
|------|------|
| Undo/Redo 범위 | 전체 작업 (모든 페이지 포함) |
| 자동저장 | 일정 시간마다 + 특정 액션 후 (페이지 이동 등) |

### 템플릿 패널

- **템플릿셋 목록**: 전체 교체용 (같은 타입/판형 필터)
- **개별 템플릿 목록**: 낱장 교체용 (같은 타입/판형 필터)
- **낱장 교체 필터**: 선택된 페이지의 템플릿 타입과 동일한 타입만 표시

### 책등 편집 기능

**활성화 조건**: 템플릿셋에 `spine` 타입 템플릿이 포함된 경우

**책등 폭 계산 공식**:
```
책등 폭 = (페이지 수 ÷ 2) × 종이 두께 + 제본 여유분
```

**지원 옵션**:

| 종이 타입 | 용도 |
|----------|------|
| 모조지 70g/80g | 본문용 |
| 서적지 70g | 본문용 |
| 신문지 45g | 본문용 |
| 아트지 200g | 표지용 |
| 매트지 200g | 표지용 |
| 카드지 300g | 표지용 |
| 크라프트지 120g | 표지용 |

| 제본 방식 | 여유분 | 조건 |
|----------|--------|------|
| 무선제본 (Perfect) | +0.5mm | 32p 이상 |
| 중철제본 (Saddle) | +0.2~0.4mm | 64p 이하, 4의 배수 |
| 스프링제본 (Spiral) | +3.0mm | - |
| 양장제본 (Hardcover) | +2.0mm | - |

**시각화 요소**:
- 실시간 미리보기 (앞표지, 책등, 뒤표지)
- 🔴 블리드(Bleed): 인쇄 시 잘려나갈 외곽 영역
- 🟠 안전 영역(Safe Area): 텍스트 보호 영역 (15mm 안쪽)
- 🟢 책등 중심선
- 경고: 책등 5mm 미만 시 텍스트 배치 주의

---

## 5. 에러 처리

| 상황 | 처리 방법 |
|------|----------|
| **저장 실패** | 자동 재시도 → 로컬 임시 저장 → 네트워크 복구 시 자동 동기화 |
| **템플릿 로드 실패** | 에러 메시지 표시 후 에디터 진입 차단 |
| **이미지 업로드 실패** | 자동 재시도 후 실패 시 에러 메시지 |
| **페이지 이탈** | 자동저장 실패 상태일 때만 경고 표시 |

---

## 6. 권한 관리

### 사용자 유형

| 유형 | 권한 |
|------|------|
| **고객** | 기본 편집, 페이지 추가/삭제(범위 내), 템플릿 교체, 잠금 요소 편집 불가 |
| **관리자** | 고객 기능 + 모든 잠금 요소 설정/해제 |
| **디자이너** | 관리자와 동일 (템플릿 제작 시 잠금 영역 설정) |

### 편집 상태

| 상태 | 편집 권한 | 설명 |
|------|----------|------|
| **편집 중 (draft)** | 고객 | 고객이 작업 중 |
| **검토 중 (review)** | 관리자 | 관리자 검토 단계 |
| **완료 (submitted)** | 관리자 (기록 남김) | 최종 완료, 수정 시 기록 |

### 편집 기록

- 모든 편집마다 **수정자(userId)** + **수정일자(modifiedAt)** 기록

### 동시 편집

- **허용하지 않음**
- 먼저 편집 중인 사용자에게 잠금
- 다른 사용자는 읽기 전용으로 접근
