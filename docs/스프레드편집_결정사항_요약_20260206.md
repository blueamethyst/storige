# 스프레드 편집 - 결정 사항 요약서

**작성일**: 2026년 2월 6일
**목적**: 기획 설계 과정에서 결정된 사항들의 컨펌용 요약

---

## A. 인터뷰 결정 사항 (기능 정의)

| # | 주제 | 질문 | 결정 |
|---|------|------|------|
| A1 | 객체 위치 정책 | 책등 크기 변경 시 인접 객체 처리 방식 | **방안 A: 각 영역 내 상대 좌표 유지** |
| A2 | 날개 지원 | 날개 포함 여부 | **상품 설정에 따라 선택적** (있을 수도 없을 수도) |
| A3 | 책등 객체 스케일 | 책등 폭 변경 시 내부 객체 처리 | **비례 스케일** (텍스트 제외) |
| A4 | 가이드라인 스타일 | 영역 경계 표시 방식 | **점선만** (색상: 회색 계열) |
| A5 | 재단선(Bleed) | 스프레드 재단선 위치 | **외곽(상하좌우)만**, 내부 경계에는 없음 |
| A6 | 객체 배치 | 영역 간 걸침 허용 여부 | **자유 배치** (영역 무관하게 자유롭게) |
| A7 | 마이그레이션 | 기존 데이터 마이그레이션 필요 여부 | **불필요** (신규 세션만 스프레드 모드) |
| A8 | 영역 스냅 | 스냅 가이드 제공 여부 | **영역 경계 + 영역 중앙 스냅** |
| A9 | 치수 표시 | mm 단위 치수 표시 여부 | **각 영역 상단에 mm 크기 표시** |
| A10 | 책등 텍스트 | 텍스트 방향 자동/수동 | **수동 설정** (자동 방향 전환 없음) |
| A11 | 3D 미리보기 | 3D 목업 미리보기 포함 여부 | **포함** (간단한 CSS 3D transform 버전) |
| A12 | 변경 알림 | 책등 폭 변경 시 알림 방식 | **토스트 메시지** ("책등 폭이 7.5mm로 변경되었습니다") |
| A13 | 최소 페이지 | 제본 방식별 최소 페이지 수 | **무선 32p, 중철 4p(4의 배수)** |
| A14 | 에디터 모드 | 기존 에디터와의 관계 | **두 가지 모드**: 단일모드(기존) + 책모드(신규) |
| A15 | 페이지 패널 | 페이지 패널 위치 | **하단 수평 패널** (좌: 스프레드, 우: 내지) |
| A16 | 스프레드 구분 | 패널 내 스프레드/내지 구분 | **좌측 스프레드 + 구분선 + 우측 내지** |
| A17 | 3D 접근 | 3D 미리보기 접근 방식 | **에디터 상단 헤더 버튼** |
| A18 | 배경 설정 | 배경 적용 방식 | **전체 통일 + 영역별 오버라이드** (영역별 > 전체) |
| A19 | 모드 결정 | 에디터 모드 결정 주체 | **상품 설정**에서 결정 |
| A20 | 기존 동작 | 단일모드 변경 여부 | **기존 유지** (코드 변경 없음) |
| A21 | 템플릿 타입 | 스프레드 템플릿 구분 | **새로운 SPREAD 타입** 추가 |
| A22 | 템플릿 편집 | 스프레드 템플릿 편집 방식 | **관리자가 스프레드 에디터(iframe)에서 직접 편집** |
| A23 | 템플릿셋 구성 | 책모드 템플릿셋 구조 | **SPREAD 1개 + PAGE N개** (기존 COVER/SPINE/WING 불허) |
| A24 | PDF 출력 | 스프레드 모드 PDF 분리 | **cover.pdf(스프레드 1p) + content.pdf(내지 Np)** 분리 |

---

## B. 설계 리뷰 결정 사항 (구현 규격)

### B-1. 객체 앵커 메타데이터

| # | 주제 | 결정 |
|---|------|------|
| B1 | 앵커 기준점 | **항상 객체의 중심점(center) 기준** (originX/originY 무관하게 환산) |
| B2 | xNorm/yNorm 범위 | 클램프하지 않음 (0 미만/1 초과 허용), **극단값 -1.0~2.0 범위 제한** |
| B3 | 강등 타이밍 | **사용자 이동 완료 시점(handleObjectModified)에서만** 수행, resizeSpine 과정에서는 강등 안 함 |
| B4 | regionRef 누락 초기화 | regionRef=null, primaryRegionHint=resolveRegionAtX(center.x), anchor={kind:'canvas'} |

### B-2. 히스테리시스 Region 판정

| # | 주제 | 결정 |
|---|------|------|
| B5 | 승격 임계치 | 자유→영역: 단일 영역에 **90% 이상** 포함 시 |
| B6 | 강등 임계치 | 영역→자유: 소속 영역에 **70% 미만** 포함 시 |
| B7 | 유지 조건 | regionRef 존재 시 **70% 이상이면 유지** |
| B8 | 바운딩 기준 | **객체 boundingRect(축 정렬 AABB)** 기준, 회전 무관 동일 규칙 |
| B9 | shadow/blur | 판정에서 **논리적 제외** (Fabric이 포함할 경우 별도 계산으로 구현) |
| B10 | AABB 면적 0 | 선/점 객체: 중심점이 영역 안이면 1, 아니면 0 |
| B11 | 교차 면적 0 | 포함율 **0**으로 간주 |

### B-3. 타입별 리사이즈 Strategy

| # | 주제 | 결정 |
|---|------|------|
| B12 | i-text/Textbox | **스케일 금지**, 영역 중앙 재정렬만 |
| B13 | Image | **비례 스케일** + strokeUniform=true 강제 + strokeWidth 유지 |
| B14 | Image 상세 | clipPath/shadow/pattern/cornerRadius는 **건드리지 않음** (Next) |
| B15 | Group (텍스트 포함) | **스케일 금지** + 중앙 재정렬만 (그룹 풀기 없음, MVP 단순화) |
| B16 | Group (텍스트 미포함) | **비례 스케일 허용** |
| B17 | 텍스트 포함 판정 | 그룹 트리 내 `type in ['i-text','textbox','text']` 존재 여부 |
| B18 | 기타 (Rect, Path 등) | **비례 스케일 허용** |

### B-4. 좌표계 및 이동 계산

| # | 주제 | 결정 |
|---|------|------|
| B19 | 내부 좌표계 | 항상 **workspace px** (= Fabric canvas 좌표) 기준 |
| B20 | mm→px 변환 지점 | 오직 2곳: computeLayout() 초기 변환 + DimensionLabel 역변환 |
| B21 | 스냅 threshold | workspace px 고정, 줌 보정 시 `threshold = basePx / zoom` |
| B22 | 이동 계산식 | getCenterPoint() 기반: `obj.setPositionByOrigin(c', 'center', 'center')` |
| B23 | 그룹 내부 객체 | 그룹 자체만 이동 (하위 건드리지 않음) |

### B-5. Debounce + History

| # | 주제 | 결정 |
|---|------|------|
| B24 | Spine API 호출 | **debounce(300ms)** + **AbortController** in-flight cancel |
| B25 | History 대상 | 내지 추가/삭제=대상, spine resize=**비대상** (layout transaction) |
| B26 | undo/redo 중 debounce | **비활성** → 마지막 상태에서 **즉시 1회만** spine 계산 |
| B27 | 복원 흐름 | `undo() → cancelPending() → immediateRecalcSpine()` |
| B28 | restoring 플래그 | useAppStore에 추가, 복원 시작~종료 관리 |

### B-6. 입력 잠금 (isLayoutTransaction)

| # | 주제 | 결정 |
|---|------|------|
| B29 | 잠금 트리거 | resizeSpine() 진입 시 `isLayoutTransaction = true` |
| B30 | 잠금 해제 | resizeSpine() finally에서 **반드시** 해제 |
| B31 | 잠금 중 금지 | `object:moving`, `object:scaling`, `selection:*` → early-return |
| B32 | 잠금 중 허용 | 캔버스 pan/zoom (선택/변형만 금지) |
| B33 | 키보드 | delete 허용, undo/redo 허용하되 pending spine cancel 후 즉시 재계산 |
| B34 | 이중 적용 | UI 레벨(툴 비활성) + 플러그인 레벨(이벤트 핸들러 early-return) |

### B-7. 시스템 객체 식별

| # | 주제 | 결정 |
|---|------|------|
| B35 | 식별 방식 | `obj.meta.system` 존재 여부로만 판정 (타입/이름 추측 금지) |
| B36 | 부여 범위 | **플러그인 생성 오브젝트에만** 부여 |
| B37 | 사용자 객체 위반 | 로드 시 사용자 객체에 meta.system 존재 → **하드 실패** |

### B-8. 세션 스냅샷 및 출력 재현

| # | 주제 | 결정 |
|---|------|------|
| B38 | 단일 소스 | **EditSession.metadata.spread**가 유일한 출력 재현 소스 |
| B39 | Template.spreadConfig | **초기화에만** 사용, 세션 생성 이후 참조 안 함 |
| B40 | 스냅샷 갱신 시점 | spine API 응답 수신 + resizeSpine **성공 이후에만** 커밋 |
| B41 | Worker 원칙 | 저장된 스냅샷 우선 사용, **재계산 금지** |

### B-9. Worker 검증

| # | 주제 | 결정 |
|---|------|------|
| B42 | cover.pdf 검증 | MediaBox가 metadata.spread와 일치해야 함 |
| B43 | 오차 허용 | **<= 0.2mm 또는 <= 1px@dpi** 중 큰 값 |
| B44 | 불일치 시 | **하드 실패** (인쇄 사고 방지, 추측 금지) |
| B45 | 스냅샷 누락 기준 | spine/spread 필수값 누락=**하드 실패**, UI 메타 누락=**소프트 경고** |

### B-10. 서버 검증

| # | 주제 | 결정 |
|---|------|------|
| B46 | editorMode=book | SPREAD 1개 필수, WING/COVER/SPINE 불허, PAGE 1개 이상 |
| B47 | editorMode=single | SPREAD 불허, 기존 검증 유지 |
| B48 | 상품 스펙 일치 | coverWidth/Height, wingEnabled → 서버에서 **강제 검증** |
| B49 | 세션 생성 시 | SpreadSpec vs 상품 스펙 **재검증** (운영 중 변경 대응) |

### B-11. Webhook / PDF 출력

| # | 주제 | 결정 |
|---|------|------|
| B50 | outputFileUrl | **항상 포함**, merged 없으면 **null** (미포함이 아닌 null) |
| B51 | outputFiles | 항상 cover/content **2개** 포함 |
| B52 | 내지 업로드 | 이번 스프린트는 **캔버스 단위 개별 업로드** 고정 |
| B53 | Worker 모드 | 기존 merge/split에 **spread** 추가 |

### B-12. UI/UX

| # | 주제 | 결정 |
|---|------|------|
| B54 | primaryRegionHint 적용 | 스냅, 정렬 메뉴에서만 사용 |
| B55 | primaryRegionHint 비적용 | 리사이즈 재배치, PDF 출력, 서버 검증 |
| B56 | 캔버스 밖 객체 | 경고 토스트, **토스트 클릭 시 zoom/pan to fit selection** |
| B57 | 썸네일 갱신 | **자동저장 완료 이벤트에만** (실시간 캡처 X) |
| B58 | 치수 라벨 | workspace top 기준 + 고정 px margin (줌 보정) |
| B59 | 3D 목업 crop | **SpreadLayout.regions**에서 계산 (raw SpreadConfig 직접 참조 금지) |

---

## C. 다음 스프린트 제외 항목 (명시적 제외)

| # | 항목 | 사유 |
|---|------|------|
| C1 | 실시간 프리플라이트 | 이번 스프린트 범위 초과 |
| C2 | 책등 텍스트 자동 리사이즈 | 수동 설정으로 결정 |
| C3 | 360도 회전 미리보기 | 간단한 3D만 |
| C4 | clipPath/shadow/pattern/cornerRadius 처리 | Image 스케일 시 Next 항목 |
| C5 | 클라이언트 content.pdf 병합 업로드 | 성능 최적화는 다음 스프린트 |
| C6 | "캔버스 밖 객체 찾기" 패널 | 토스트 클릭 UX만 이번 스프린트 |

---

**관련 문서**:
- [상세 설계서](/docs/스프레드편집_상세설계서_20260206.md)
- [기획회의 요약](/docs/사양변경_기획회의_요약_20260205.md)
